<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bajaj Task Management Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        :root { 
            --primary: #2c3e50; --secondary: #34495e; --accent: #3498db; 
            --light: #f8f9fa; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f;
            --purple: #9b59b6; --gray: #718096;
        }
        
        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: #f0f2f5; margin: 0; padding: 10px; color: #1a202c; 
        }

        .container { 
            max-width: 1300px; margin: auto; background: transparent; 
        }

        .hidden { display: none !important; }
        
        /* Dashboard Header */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }

        h2 { color: var(--primary); margin: 0; font-size: 1.4rem; }

        /* Stats Section */
        .flex-row { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }

        .stat-box { 
            flex: 1; min-width: 140px; padding: 20px; border-radius: 12px; 
            color: white; text-align: center; cursor: pointer; 
            transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-box:hover { transform: translateY(-3px); filter: brightness(1.1); }
        .stat-box b { font-size: 28px; display: block; margin-top: 5px; }

        /* ADMIN ACTION GRID */
        .admin-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white; border-radius: 15px; padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            border: 1px solid #edf2f7; display: flex; flex-direction: column;
        }

        .action-header { display: flex; align-items: center; margin-bottom: 20px; gap: 12px; }
        .icon-circle {
            width: 40px; height: 40px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 1.2rem;
        }

        /* Inputs & Labels */
        .input-group { margin-bottom: 12px; }
        .input-label { 
            font-size: 11px; font-weight: 700; color: var(--gray);
            margin-bottom: 5px; display: block; text-transform: uppercase;
        }

        input, select, textarea { 
            padding: 12px; width: 100%; border: 2px solid #edf2f7; 
            border-radius: 8px; font-size: 14px; box-sizing: border-box;
            background: #f7fafc; transition: 0.2s;
        }
        input:focus, select:focus { border-color: var(--accent); background: white; outline: none; }

        .btn-grad {
            padding: 14px; border-radius: 8px; border: none; color: white;
            font-weight: 700; cursor: pointer; margin-top: auto; transition: 0.3s;
        }
        .btn-grad:active { transform: scale(0.97); }

        /* Table Design */
        .table-section {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        .table-container { width: 100%; overflow-x: auto; border-radius: 8px; }

        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #f8fafc; color: var(--gray); text-transform: uppercase; font-size: 12px; padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }

        /* Badges */
        .status-tag { padding: 5px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .Initial { background: #e2e8f0; color: #475569; }
        .In-Process { background: #fef3c7; color: #92400e; }
        .Completed { background: #dcfce7; color: #166534; }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-header { flex-direction: column; gap: 10px; text-align: center; }
            .stat-box { min-width: calc(50% - 10px); }
            .logout { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="login-section">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div class="action-card" style="width: 100%; max-width: 400px; border-top: 5px solid var(--accent);">
                <h2 style="text-align:center; margin-bottom:20px;">BAJAJ TASK SYSTEM</h2>
                <input type="text" id="login-id" placeholder="Admin or Employee Code">
                <button onclick="handleLogin()" class="btn-grad" style="background: var(--accent); margin-top:15px;">Access Dashboard</button>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="hidden">
        <div class="dashboard-header">
            <h2>Admin Control Panel</h2>
            <button class="btn-grad" onclick="logout()" style="background: var(--danger); padding: 8px 20px;">Logout</button>
        </div>
        
        <div class="flex-row">
            <div class="stat-box" onclick="setFilter('Initial')" style="background: var(--gray);"><small>INITIAL</small><b id="stat-initial">0</b></div>
            <div class="stat-box" onclick="setFilter('In-Process')" style="background: var(--warning); color: #333;"><small>IN-PROCESS</small><b id="stat-progress">0</b></div>
            <div class="stat-box" onclick="setFilter('Completed')" style="background: var(--success);"><small>COMPLETED</small><b id="stat-completed">0</b></div>
            <div class="stat-box" onclick="setFilter('All')" style="background: var(--primary);"><small>TOTAL TASKS</small><b>âˆž</b></div>
        </div>

        <div class="admin-actions-grid">
            <div class="action-card">
                <div class="action-header">
                    <div class="icon-circle" style="background: var(--primary);">+</div>
                    <h3>Staff Registration</h3>
                </div>
                <div class="input-group">
                    <span class="input-label">Full Name</span>
                    <input type="text" id="reg-name" placeholder="John Doe">
                </div>
                <div class="input-group">
                    <span class="input-label">Employee Code</span>
                    <input type="text" id="reg-code" placeholder="ASO-101">
                </div>
                <div class="input-group">
                    <span class="input-label">Contact Details</span>
                    <input type="text" id="reg-desig" placeholder="Designation">
                    <input type="tel" id="reg-phone" placeholder="Phone Number" style="margin-top:8px;">
                </div>
                <button onclick="saveEmployee()" class="btn-grad" style="background: var(--primary);">Save Staff Member</button>
            </div>

            <div class="action-card">
                <div class="action-header">
                    <div class="icon-circle" style="background: var(--purple);">G</div>
                    <h3>Group Assignment</h3>
                </div>
                <div class="input-group">
                    <span class="input-label">Group Name</span>
                    <input type="text" id="group-name-input" placeholder="Project Team A">
                </div>
                <div class="input-group">
                    <span class="input-label">Leader & Members</span>
                    <select id="group-leader-select"></select>
                    <select id="group-members-select" multiple style="margin-top:8px; height: 80px;"></select>
                </div>
                <div class="input-group">
                    <span class="input-label">Task Details</span>
                    <input type="text" id="group-task-name" placeholder="Objective of the group">
                </div>
                <button onclick="assignGroupTask()" class="btn-grad" style="background: var(--purple);">Deploy Group Task</button>
            </div>

            <div class="action-card">
                <div class="action-header">
                    <div class="icon-circle" style="background: var(--success);">T</div>
                    <h3>Individual Task</h3>
                </div>
                <div class="input-group">
                    <span class="input-label">Select Staff</span>
                    <select id="task-assignee"></select>
                </div>
                <div class="input-group">
                    <span class="input-label">Task Description</span>
                    <textarea id="task-name" style="height: 125px;" placeholder="Describe the task instructions..."></textarea>
                </div>
                <button onclick="assignTask()" class="btn-grad" style="background: var(--success);">Assign Single Task</button>
            </div>
        </div>

        <div class="table-section">
            <h3 style="margin-top:0; color: var(--primary);">Monitoring Live Feed</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Staff/Group</th>
                            <th>Designation</th>
                            <th>Task Details</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="admin-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="employee-dashboard" class="hidden">
        <div class="dashboard-header">
            <h2>Welcome, <span id="display-emp-name"></span></h2>
            <button class="btn-grad" onclick="logout()" style="background: var(--danger); padding: 8px 20px;">Logout</button>
        </div>
        <div id="emp-task-cards" class="admin-actions-grid"></div>
    </div>
</div>

<script>
    // 
    const firebaseConfig = {
        apiKey: "AIzaSyAmQil4nkkdp98pAYCILemHxRTYCAy5nEw",
        authDomain: "taskmanager-45c3a.firebaseapp.com",
        databaseURL: "https://taskmanager-45c3a-default-rtdb.firebaseio.com",
        projectId: "taskmanager-45c3a",
        storageBucket: "taskmanager-45c3a.firebasestorage.app",
        messagingSenderId: "710242454866",
        appId: "1:710242454866:web:a87f396d484014f7c67e8b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let currentUser = null;
    let globalEmpData = {};
    let currentFilter = 'All';

    function handleLogin() {
        const id = document.getElementById('login-id').value.trim();
        if(['ADMIN00001', 'ASO-1', 'ASO-2'].includes(id)) {
            currentUser = { role: 'admin', id: id };
            showDashboard('admin');
        } else {
            db.ref('employees/' + id).once('value', snap => {
                if(snap.exists()) { 
                    currentUser = snap.val(); 
                    showDashboard('employee'); 
                } else { alert("User Code not found!"); }
            });
        }
    }

    function showDashboard(type) {
        document.getElementById('login-section').classList.add('hidden');
        if(type === 'admin') {
            document.getElementById('admin-dashboard').classList.remove('hidden');
            loadAdminData();
        } else {
            document.getElementById('employee-dashboard').classList.remove('hidden');
            document.getElementById('display-emp-name').innerText = currentUser.name;
            loadEmployeeTasks();
        }
    }

    function saveEmployee() {
        const n = document.getElementById('reg-name').value;
        const c = document.getElementById('reg-code').value;
        const d = document.getElementById('reg-desig').value;
        const p = document.getElementById('reg-phone').value;
        if(n && c) {
            db.ref('employees/' + c).set({ name: n, code: c, designation: d, phone: p });
            alert("Staff Registered!");
            document.querySelectorAll('input').forEach(i => i.value = "");
        }
    }

    function assignTask() {
        const c = document.getElementById('task-assignee').value;
        const t = document.getElementById('task-name').value;
        if(t) {
            db.ref('tasks/' + c).push({ taskName: t, status: 'Initial', date: new Date().toLocaleDateString() });
            alert("Task Assigned!");
            document.getElementById('task-name').value = "";
        }
    }

    function assignGroupTask() {
        const gName = document.getElementById('group-name-input').value;
        const leader = document.getElementById('group-leader-select').value;
        const select = document.getElementById('group-members-select');
        const members = Array.from(select.selectedOptions).map(opt => opt.value);
        const taskName = document.getElementById('group-task-name').value;

        if (!gName || members.length < 1 || !taskName) return alert("Fill all fields");

        db.ref('group_tasks').push({
            groupName: gName, leader: leader, taskName: taskName, 
            members: members, status: 'Initial', date: new Date().toLocaleDateString()
        }).then(() => {
            alert("Group Task Assigned!");
            document.getElementById('group-task-name').value = "";
        });
    }

    function loadAdminData() {
        db.ref('employees').on('value', snap => {
            let opts = "";
            globalEmpData = snap.val() || {}; 
            snap.forEach(e => { opts += `<option value="${e.key}">${e.val().name} (${e.key})</option>`; });
            document.getElementById('task-assignee').innerHTML = opts;
            document.getElementById('group-leader-select').innerHTML = opts;
            document.getElementById('group-members-select').innerHTML = opts;
        });

        db.ref().on('value', snap => {
            let rows = "";
            let counts = { Initial: 0, 'In-Process': 0, Completed: 0 };
            const tasks = snap.child('tasks').val() || {};
            const groupTasks = snap.child('group_tasks').val() || {};

            Object.keys(tasks).forEach(empCode => {
                const staff = globalEmpData[empCode] || { name: empCode };
                Object.keys(tasks[empCode]).forEach(tKey => {
                    const t = tasks[empCode][tKey];
                    counts[t.status]++;
                    if(currentFilter === 'All' || t.status === currentFilter) {
                        rows += `<tr>
                            <td><b>${staff.name}</b><br><small>${empCode}</small></td>
                            <td>${staff.designation || '-'}</td>
                            <td>${t.taskName}</td>
                            <td><span class="status-tag ${t.status}">${t.status}</span></td>
                            <td><button onclick="deleteTask('${empCode}','${tKey}','single')" style="color:var(--danger); border:none; background:none; cursor:pointer;">Delete</button></td>
                        </tr>`;
                    }
                });
            });

            Object.keys(groupTasks).forEach(gKey => {
                const gt = groupTasks[gKey];
                counts[gt.status]++;
                if(currentFilter === 'All' || gt.status === currentFilter) {
                    rows += `<tr style="background:#fcfaff">
                        <td><b style="color:var(--purple)">${gt.groupName}</b></td>
                        <td>Leader: ${globalEmpData[gt.leader]?.name || 'N/A'}</td>
                        <td>${gt.taskName}</td>
                        <td><span class="status-tag ${gt.status}">${gt.status}</span></td>
                        <td><button onclick="deleteTask(null,'${gKey}','group')" style="color:var(--danger); border:none; background:none; cursor:pointer;">Delete</button></td>
                    </tr>`;
                }
            });

            document.getElementById('admin-list').innerHTML = rows;
            document.getElementById('stat-initial').innerText = counts.Initial;
            document.getElementById('stat-progress').innerText = counts['In-Process'];
            document.getElementById('stat-completed').innerText = counts.Completed;
        });
    }

    function loadEmployeeTasks() {
        const empCode = currentUser.code;
        db.ref().on('value', snap => {
            let html = "";
            const tasks = snap.child('tasks/' + empCode).val() || {};
            const groupTasks = snap.child('group_tasks').val() || {};

            Object.keys(tasks).forEach(tid => {
                html += createTaskCard(tasks[tid].taskName, tasks[tid].status, tid, 'single');
            });

            Object.keys(groupTasks).forEach(gid => {
                if(groupTasks[gid].members.includes(empCode)) {
                    html += createTaskCard(`${groupTasks[gid].groupName}: ${groupTasks[gid].taskName}`, groupTasks[gid].status, gid, 'group');
                }
            });
            document.getElementById('emp-task-cards').innerHTML = html || "<p>No active tasks assigned.</p>";
        });
    }

    function createTaskCard(name, status, id, type) {
        return `<div class="action-card" style="border-left: 5px solid ${type==='group'?'var(--purple)':'var(--accent)'}">
            <h3 style="font-size: 1rem; margin-bottom: 15px;">${name}</h3>
            <div class="input-group">
                <span class="input-label">Update Progress</span>
                <select id="sel-${id}">
                    <option value="Initial" ${status=='Initial'?'selected':''}>Initial</option>
                    <option value="In-Process" ${status=='In-Process'?'selected':''}>In-Process</option>
                    <option value="Completed" ${status=='Completed'?'selected':''}>Completed</option>
                </select>
            </div>
            <button onclick="updateStatus('${id}', '${type}')" class="btn-grad" style="background: var(--success);">Update Task</button>
        </div>`;
    }

    function updateStatus(id, type) {
        const val = document.getElementById('sel-'+id).value;
        const path = type === 'single' ? `tasks/${currentUser.code}/${id}` : `group_tasks/${id}`;
        db.ref(path).update({ status: val }).then(() => alert("Progress Synced!"));
    }

    function deleteTask(empCode, tKey, type) {
        if(confirm("Confirm Delete?")) {
            const path = type === 'single' ? `tasks/${empCode}/${tKey}` : `group_tasks/${tKey}`;
            db.ref(path).remove();
        }
    }

    function logout() { location.reload(); }
    function setFilter(s) { currentFilter = s; loadAdminData(); }
</script>
</body>
</html>
