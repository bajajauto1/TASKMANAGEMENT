<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bajaj Task Management Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        :root { 
            --primary: #2c3e50; --secondary: #34495e; --accent: #3498db; 
            --light: #f8f9fa; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f;
            --purple: #9b59b6; --gray: #718096; --gold: #f39c12; --teal: #1abc9c;
        }
        
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f2f5; margin: 0; padding: 10px; color: #1a202c; }
        .container { max-width: 1300px; margin: auto; }
        .hidden { display: none !important; }
        
        /* Headers & Nav */
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.04); }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .nav-btn { padding: 10px 20px; border-radius: 8px; border: 1px solid #ddd; background: white; cursor: pointer; font-weight: 700; transition: 0.3s; }
        .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Stats */
        .stat-box { flex: 1; min-width: 140px; padding: 20px; border-radius: 12px; color: white; text-align: center; cursor: pointer; transition: 0.3s; }
        .stat-box b { font-size: 28px; display: block; margin-top: 5px; }
        .flex-row { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }

        /* Forms & Cards */
        .admin-actions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .action-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #edf2f7; display: flex; flex-direction: column; }
        .action-header { display: flex; align-items: center; margin-bottom: 20px; gap: 12px; }
        .icon-circle { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }

        .input-label { font-size: 11px; font-weight: 700; color: var(--gray); margin-bottom: 5px; display: block; text-transform: uppercase; }
        input, select, textarea { padding: 12px; width: 100%; border: 2px solid #edf2f7; border-radius: 8px; box-sizing: border-box; background: #f7fafc; font-size: 14px; margin-bottom: 10px; }
        .btn-grad { padding: 14px; border-radius: 8px; border: none; color: white; font-weight: 700; cursor: pointer; transition: 0.3s; }

        /* NEW: Vertical Material Card Design */
        .material-card { background: white; border-radius: 12px; border: 1px solid #edf2f7; margin-bottom: 15px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .material-card-header { padding: 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; transition: 0.2s; }
        .material-card-header:hover { background: #f8fafc; }
        .material-info h4 { margin: 0; color: var(--primary); font-size: 16px; }
        .material-info p { margin: 4px 0 0; color: var(--gray); font-size: 12px; }
        .material-card-body { padding: 0 20px; max-height: 0; overflow: hidden; transition: all 0.4s ease; background: #fbfcfe; }
        .material-card.active .material-card-body { padding: 20px; max-height: 1200px; border-top: 1px solid #eee; }
        
        .badge-qty { background: var(--teal); color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; }
        .vendor-box { background: white; padding: 12px; border-radius: 8px; border: 1px dashed var(--teal); margin-bottom: 15px; }

        /* Flowchart steps */
        .vertical-flow { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .flow-step-item { display: flex; align-items: center; gap: 12px; padding: 10px; background: white; border-radius: 8px; border: 1px solid #edf2f7; font-size: 13px; }
        .flow-step-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; accent-color: var(--teal); }

        /* Tables (General/Billing) */
        .table-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: #f8fafc; color: var(--gray); font-size: 11px; padding: 15px; text-align: left; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        
        /* UPDATED REMARKS STYLING */
        .status-tag { padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: 700; }
        .Assigned { background: #e2e8f0; color: #4a5568; }
        .WIP { background: #feebc8; color: #92400e; }
        .Completed { background: #c6f6d5; color: #22543d; }
        
        .step-pill { display: inline-block; padding: 2px 6px; border-radius: 4px; background: #edf2f7; font-size: 9px; margin: 2px; }
        .step-pill.done { background: var(--success); color: white; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-section">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center;">
            <div class="action-card" style="width: 100%; max-width: 400px; border-top: 5px solid var(--accent);">
                <h2 style="text-align:center;">BAJAJ TASK SYSTEM</h2>
                <input type="text" id="login-id" placeholder="Admin or Employee Code">
                <button onclick="handleLogin()" class="btn-grad" style="background: var(--accent); margin-top:5px;">Access Dashboard</button>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="hidden">
        <div class="dashboard-header">
            <h2>Admin Control Panel</h2>
            <button class="btn-grad" onclick="logout()" style="background: var(--danger); padding: 8px 20px;">Logout</button>
        </div>

        <div class="nav-tabs">
            <button class="nav-btn active" id="tab-tasks" onclick="switchAdminTab('tasks')">Task Management</button>
            <button class="nav-btn" id="tab-billing" onclick="switchAdminTab('billing')">Agency Billing Flow</button>
            <button class="nav-btn" id="tab-material" onclick="switchAdminTab('material')">Material Procurement</button>
        </div>

        <div id="admin-task-view">
            <div class="flex-row">
                <div class="stat-box" style="background: var(--gray);"><small>ASSIGNED</small><b id="stat-initial">0</b></div>
                <div class="stat-box" style="background: var(--warning); color:#333;"><small>WIP</small><b id="stat-progress">0</b></div>
                <div class="stat-box" style="background: var(--success);"><small>COMPLETED</small><b id="stat-completed">0</b></div>
            </div>
            <div class="admin-actions-grid">
                <div class="action-card">
                    <div class="action-header"><div class="icon-circle" style="background: var(--primary);">+</div><h3>Staff Registration</h3></div>
                    <input type="text" id="reg-name" placeholder="Full Name">
                    <input type="text" id="reg-code" placeholder="Employee Code">
                    <input type="text" id="reg-desig" placeholder="Designation">
                    <input type="tel" id="reg-phone" placeholder="Phone Number">
                    <button onclick="saveEmployee()" class="btn-grad" style="background: var(--primary);">Save Staff</button>
                </div>
                <div class="action-card">
                    <div class="action-header"><div class="icon-circle" style="background: var(--purple);">G</div><h3>Group Task</h3></div>
                    <input type="text" id="group-name-input" placeholder="Group Name">
                    <span class="input-label">Leader</span>
                    <select id="group-leader-select"></select>
                    <span class="input-label">Members (Hold Ctrl)</span>
                    <select id="group-members-select" multiple style="height: 80px;"></select>
                    <input type="text" id="group-task-name" placeholder="Group Objective">
                    <button onclick="assignGroupTask()" class="btn-grad" style="background: var(--purple);">Deploy Group</button>
                </div>
                <div class="action-card">
                    <div class="action-header"><div class="icon-circle" style="background: var(--success);">T</div><h3>Individual Task</h3></div>
                    <select id="task-assignee"></select>
                    <textarea id="task-name" placeholder="Task Details..." style="height: 80px;"></textarea>
                    <button onclick="assignTask()" class="btn-grad" style="background: var(--success);">Assign Task</button>
                </div>
            </div>
            <div class="table-section">
                <h3>Live Task Feed</h3>
                <table>
                    <thead><tr><th>Staff/Group</th><th>Type</th><th>Details</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody id="admin-list"></tbody>
                </table>
            </div>
        </div>

        <div id="admin-billing-view" class="hidden">
            <div class="admin-actions-grid">
                <div class="action-card">
                    <div class="action-header"><div class="icon-circle" style="background: var(--gold);">$</div><h3>New Billing Assignment</h3></div>
                    <select id="bill-assignee"></select>
                    <select id="bill-agency">
                        <option>ANSEC</option><option>BAKUL</option><option>SCRUM</option>
                        <option>COMMANDO DOG</option><option>SWIFT SECURITY</option>
                        <option>EXPERT CORP</option><option>DELTA FORCE</option>
                        <option>G4S</option><option>SIS</option><option>TERRIER</option>
                    </select>
                    <button onclick="assignBilling()" class="btn-grad" style="background: var(--gold);">Generate Flow</button>
                    <button onclick="resetBilling()" class="btn-grad" style="background: var(--danger); margin-top:10px;">RESET ALL BILLS</button>
                </div>
            </div>
            <div class="table-section">
                <table>
                    <thead><tr><th>Employee</th><th>Agency</th><th>Progress</th><th>Date</th><th>Action</th></tr></thead>
                    <tbody id="admin-billing-list"></tbody>
                </table>
            </div>
        </div>

        <div id="admin-material-view" class="hidden">
            <div class="admin-actions-grid">
                <div class="action-card">
                    <div class="action-header"><div class="icon-circle" style="background: var(--teal);">M</div><h3>New Material Request</h3></div>
                    <input type="text" id="mat-code" placeholder="Product Code (e.g. MOB-01)">
                    <input type="text" id="mat-name" placeholder="Product Name">
                    <textarea id="mat-desc" placeholder="Description..." style="height: 60px;"></textarea>
                    <input type="number" id="mat-qty" placeholder="Quantity">
                    <span class="input-label">Assign To Lead</span>
                    <select id="mat-assign-ind"></select>
                    <span class="input-label">Group Members (Optional)</span>
                    <select id="mat-assign-grp" multiple style="height: 80px;"></select>
                    <button onclick="assignMaterial()" class="btn-grad" style="background: var(--teal);">Create Procurement</button>
                </div>
                <div style="grid-column: span 2;">
                    <h3>Material Tracking</h3>
                    <div id="admin-material-cards-container"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="employee-dashboard" class="hidden">
        <div class="dashboard-header">
            <h2>Welcome, <span id="display-emp-name"></span></h2>
            <button class="btn-grad" onclick="logout()" style="background: var(--danger); padding: 8px 20px;">Logout</button>
        </div>
        <div class="nav-tabs">
            <button class="nav-btn active" id="emp-tab-tasks" onclick="switchEmpTab('tasks')">General Tasks</button>
            <button class="nav-btn" id="emp-tab-bill" onclick="switchEmpTab('billing')">Billing Checklist</button>
            <button class="nav-btn" id="emp-tab-mat" onclick="switchEmpTab('material')">Material Procurement</button>
        </div>
        <div id="employee-task-view"><div id="emp-task-cards" class="admin-actions-grid"></div></div>
        <div id="employee-billing-view" class="hidden"><div id="emp-billing-cards" class="admin-actions-grid"></div></div>
        <div id="employee-material-view" class="hidden"><div id="emp-material-cards" style="max-width: 800px;"></div></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAmQil4nkkdp98pAYCILemHxRTYCAy5nEw",
        authDomain: "taskmanager-45c3a.firebaseapp.com",
        databaseURL: "https://taskmanager-45c3a-default-rtdb.firebaseio.com",
        projectId: "taskmanager-45c3a",
        storageBucket: "taskmanager-45c3a.firebasestorage.app",
        messagingSenderId: "710242454866",
        appId: "1:710242454866:web:a87f396d484014f7c67e8b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser = null;
    let globalEmpData = {};

    const billingSteps = ["Approval Note", "PR", "Attendance Verification", "PO", "Billing Verification", "Release"];
    const materialSteps = ["1", "3 Quotations", "Negotiation Committee", "Approval Note", "Item Code Generation", "Vendor Name Update", "PR", "PO", "Material Received", "Billing Processed"];

    function handleLogin() {
        const id = document.getElementById('login-id').value.trim();
        if(['ADMIN00001', 'ASO1', 'ASO-2'].includes(id)) {
            currentUser = { role: 'admin', id: id };
            showDashboard('admin');
        } else {
            db.ref('employees/' + id).once('value', snap => {
                if(snap.exists()) { currentUser = snap.val(); showDashboard('employee'); }
                else { alert("User Code Not Found!"); }
            });
        }
    }

    function showDashboard(type) {
        document.getElementById('login-section').classList.add('hidden');
        if(type === 'admin') {
            document.getElementById('admin-dashboard').classList.remove('hidden');
            loadAdminData();
            loadBillingAdmin();
            loadMaterialAdmin();
        } else {
            document.getElementById('employee-dashboard').classList.remove('hidden');
            document.getElementById('display-emp-name').innerText = `${currentUser.name} (${currentUser.code})`;
            loadEmployeeTasks();
            loadEmployeeBilling();
            loadEmployeeMaterials();
        }
    }

    // --- TAB NAVIGATION ---
    function switchAdminTab(view) {
        document.getElementById('admin-task-view').classList.toggle('hidden', view !== 'tasks');
        document.getElementById('admin-billing-view').classList.toggle('hidden', view !== 'billing');
        document.getElementById('admin-material-view').classList.toggle('hidden', view !== 'material');
        document.getElementById('tab-tasks').classList.toggle('active', view === 'tasks');
        document.getElementById('tab-billing').classList.toggle('active', view === 'billing');
        document.getElementById('tab-material').classList.toggle('active', view === 'material');
    }

    function switchEmpTab(view) {
        document.getElementById('employee-task-view').classList.toggle('hidden', view !== 'tasks');
        document.getElementById('employee-billing-view').classList.toggle('hidden', view !== 'billing');
        document.getElementById('employee-material-view').classList.toggle('hidden', view !== 'material');
        document.getElementById('emp-tab-tasks').classList.toggle('active', view === 'tasks');
        document.getElementById('emp-tab-bill').classList.toggle('active', view === 'billing');
        document.getElementById('emp-tab-mat').classList.toggle('active', view === 'material');
    }

    // --- MATERIAL PROCUREMENT LOGIC ---
    function assignMaterial() {
        const code = document.getElementById('mat-code').value, name = document.getElementById('mat-name').value;
        const desc = document.getElementById('mat-desc').value, qty = document.getElementById('mat-qty').value;
        const lead = document.getElementById('mat-assign-ind').value;
        const members = Array.from(document.getElementById('mat-assign-grp').selectedOptions).map(o => o.value);

        if(!code || !name || !lead) return alert("Fill required fields!");
        const flow = {}; materialSteps.forEach(s => flow[s.replace(/ /g,"_")] = false);

        db.ref('material_procurement').push({
            productCode: code, productName: name, description: desc, quantity: qty,
            leadCode: lead, leadName: globalEmpData[lead].name, members: members,
            vendorName: "", flow: flow, status: 'Assigned', date: new Date().toLocaleDateString()
        });
        alert("Material Task Deployed!");
    }

    function loadMaterialAdmin() {
        db.ref('material_procurement').on('value', snap => {
            let html = "";
            snap.forEach(child => {
                const m = child.val();
                let flowProgress = "";
                materialSteps.forEach(s => {
                    const key = s.replace(/ /g,"_");
                    flowProgress += `<div class="flow-step-item"><span>${m.flow && m.flow[key] ? '✅' : '⏳'}</span><label>${s}</label></div>`;
                });
                html += `
                <div class="material-card" id="adm-mat-${child.key}">
                    <div class="material-card-header" onclick="toggleCard('adm-mat-${child.key}')">
                        <div class="material-info"><h4>${m.productName} (${m.productCode})</h4><p>Lead: ${m.leadName} | Vendor: ${m.vendorName || 'Pending'}</p></div>
                        <div><span class="badge-qty">Qty: ${m.quantity}</span> <button onclick="deleteMaterial('${child.key}')" style="border:none; background:none; color:red; cursor:pointer; margin-left:10px;">✕</button></div>
                    </div>
                    <div class="material-card-body"><div class="vertical-flow">${flowProgress}</div></div>
                </div>`;
            });
            document.getElementById('admin-material-cards-container').innerHTML = html;
        });
    }

    function loadEmployeeMaterials() {
        db.ref('material_procurement').on('value', snap => {
            let html = "";
            snap.forEach(child => {
                const m = child.val();
                if(m.leadCode === currentUser.code || (m.members && m.members.includes(currentUser.code))) {
                    let checklist = "";
                    materialSteps.forEach(s => {
                        const key = s.replace(/ /g,"_");
                        checklist += `<div class="flow-step-item"><input type="checkbox" ${m.flow && m.flow[key] ? 'checked' : ''} onchange="updateMatStep('${child.key}','${key}',this.checked)"><label>${s}</label></div>`;
                    });
                    html += `
                    <div class="material-card" id="emp-mat-${child.key}">
                        <div class="material-card-header" onclick="toggleCard('emp-mat-${child.key}')">
                            <div class="material-info"><h4>${m.productName}</h4><p>${m.productCode} | ${m.description}</p></div>
                            <span style="color:var(--teal); font-size:12px;">View Details</span>
                        </div>
                        <div class="material-card-body">
                            <div class="vendor-box"><span class="input-label">Vendor Name (Text)</span><input type="text" value="${m.vendorName || ''}" onchange="updateVendor('${child.key}', this.value)" placeholder="Enter vendor..."></div>
                            <div class="vertical-flow"><p><b>Checklist:</b></p>${checklist}</div>
                        </div>
                    </div>`;
                }
            });
            document.getElementById('emp-material-cards').innerHTML = html || "<p>No materials assigned.</p>";
        });
    }

    // --- SHARED DATA LOADING ---
    function loadAdminData() {
        db.ref('employees').on('value', snap => {
            let opts = ""; globalEmpData = snap.val() || {};
            snap.forEach(e => { opts += `<option value="${e.key}">${e.key} - ${e.val().name}</option>`; });
            document.getElementById('task-assignee').innerHTML = opts;
            document.getElementById('group-leader-select').innerHTML = opts;
            document.getElementById('group-members-select').innerHTML = opts;
            document.getElementById('bill-assignee').innerHTML = opts;
            document.getElementById('mat-assign-ind').innerHTML = opts;
            document.getElementById('mat-assign-grp').innerHTML = opts;
        });

        db.ref().on('value', snap => {
            let rows = "", counts = {Assigned:0, 'WIP':0, Completed:0};
            const tasks = snap.child('tasks').val() || {}, groups = snap.child('group_tasks').val() || {};
            Object.keys(tasks).forEach(c => Object.keys(tasks[c]).forEach(k => {
                const t = tasks[c][k]; counts[t.status]++;
                rows += `<tr><td>${globalEmpData[c]?.name || c}</td><td>Individual</td><td>${t.taskName}</td><td><span class="status-tag ${t.status}">${t.status}</span></td><td><button onclick="deleteTask('${c}','${k}','single')">X</button></td></tr>`;
            }));
            Object.keys(groups).forEach(k => {
                const g = groups[k]; counts[g.status]++;
                rows += `<tr style="background:#f9f5ff"><td><b>${g.groupName}</b></td><td>Group</td><td>${g.taskName}</td><td><span class="status-tag ${g.status}">${g.status}</span></td><td><button onclick="deleteTask(null,'${k}','group')">X</button></td></tr>`;
            });
            document.getElementById('admin-list').innerHTML = rows;
            document.getElementById('stat-initial').innerText = counts.Assigned;
            document.getElementById('stat-progress').innerText = counts['WIP'];
            document.getElementById('stat-completed').innerText = counts.Completed;
        });
    }

    // --- OTHER CORE LOGIC ---
    function saveEmployee() {
        const n = document.getElementById('reg-name').value, c = document.getElementById('reg-code').value;
        if(n && c) db.ref('employees/'+c).set({name:n, code:c, designation:document.getElementById('reg-desig').value, phone:document.getElementById('reg-phone').value}).then(()=>alert("Saved"));
    }
    function assignTask() {
        const c = document.getElementById('task-assignee').value, t = document.getElementById('task-name').value;
        if(t) db.ref('tasks/'+c).push({taskName:t, status:'Assigned', date:new Date().toLocaleDateString()});
    }
    function assignGroupTask() {
        const g = document.getElementById('group-name-input').value, l = document.getElementById('group-leader-select').value;
        const m = Array.from(document.getElementById('group-members-select').selectedOptions).map(o => o.value);
        db.ref('group_tasks').push({ groupName: g, leader: l, leaderName: globalEmpData[l].name, members: m, taskName: document.getElementById('group-task-name').value, status: 'Assigned' });
    }
    function assignBilling() {
        const c = document.getElementById('bill-assignee').value, a = document.getElementById('bill-agency').value;
        const f = {}; billingSteps.forEach(s => f[s.replace(/ /g,"_")] = false);
        db.ref('agency_billing').push({ empCode: c, empName: globalEmpData[c].name, agency: a, flow: f, date: new Date().toLocaleDateString() });
    }
    function loadBillingAdmin() {
        db.ref('agency_billing').on('value', snap => {
            let r = ""; snap.forEach(c => {
                const b = c.val(); let p = ""; billingSteps.forEach(s => p += `<span class="step-pill ${b.flow && b.flow[s.replace(/ /g,"_")] ? 'done' : ''}">${s}</span>`);
                r += `<tr><td>${b.empName}</td><td>${b.agency}</td><td>${p}</td><td>${b.date}</td><td><button onclick="deleteBill('${c.key}')">X</button></td></tr>`;
            });
            document.getElementById('admin-billing-list').innerHTML = r;
        });
    }
    function loadEmployeeTasks() {
        db.ref('tasks/'+currentUser.code).on('value', snap => {
            let h = ""; snap.forEach(c => {
                const t = c.val(); h += `<div class="action-card"><h3>${t.taskName}</h3><select id="s-${c.key}"><option value="Assigned" ${t.status==='Assigned'?'selected':''}>Assigned</option><option value="WIP" ${t.status==='WIP'?'selected':''}>WIP</option><option value="Completed" ${t.status==='Completed'?'selected':''}>Completed</option></select><button onclick="updateStatus('${c.key}','single')" class="btn-grad">Update</button></div>`;
            });
            document.getElementById('emp-task-cards').innerHTML = h;
        });
    }
    function loadEmployeeBilling() {
        db.ref('agency_billing').on('value', snap => {
            let h = ""; snap.forEach(c => {
                const b = c.val(); if(b.empCode === currentUser.code) {
                    let chk = ""; billingSteps.forEach(s => { const k = s.replace(/ /g,"_"); chk += `<div class="flow-step-item"><input type="checkbox" ${b.flow && b.flow[k] ? 'checked' : ''} onchange="updateBillStep('${c.key}','${k}',this.checked)"><label>${s}</label></div>`; });
                    h += `<div class="action-card"><h3>${b.agency} Flow</h3>${chk}</div>`;
                }
            });
            document.getElementById('emp-billing-cards').innerHTML = h;
        });
    }

    // --- HELPERS ---
    function toggleCard(id) { document.getElementById(id).classList.toggle('active'); }
    function updateMatStep(id, key, val) { db.ref(`material_procurement/${id}/flow/${key}`).set(val); }
    function updateVendor(id, val) { db.ref(`material_procurement/${id}/vendorName`).set(val); }
    function updateStatus(id, type) { const v = document.getElementById('s-'+id).value; db.ref(type==='single'?`tasks/${currentUser.code}/${id}`:`group_tasks/${id}`).update({status:v}); }
    function deleteMaterial(id) { if(confirm("Delete?")) db.ref('material_procurement/'+id).remove(); }
    function deleteBill(id) { db.ref('agency_billing/'+id).remove(); }
    function resetBilling() { if(confirm("Reset all?")) db.ref('agency_billing').remove(); }
    function deleteTask(c, k, t) { db.ref(t==='single'?`tasks/${c}/${k}`:`group_tasks/${k}`).remove(); }
    function logout() { location.reload(); }
</script>
</body>
</html>
